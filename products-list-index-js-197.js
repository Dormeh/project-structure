"use strict";(self.webpackChunkproject_structure=self.webpackChunkproject_structure||[]).push([[197],{842:(e,t,s)=>{s.d(t,{Z:()=>n});class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",{duration:t=1e3,type:s="success"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,r,a;a=void 0,(r="element")in(i=this)?Object.defineProperty(i,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[r]=a,this.duration=t,this.message=e,this.type=s,this.render(),n.isAlreadyShow?n.isAlreadyShow.remove(n.isAlreadyShow):n.isAlreadyShow=!1}getTemplate(){return`<div class="notification" style="--value:2s">\n    <div class="timer"></div>\n    <div class="inner-wrapper">\n      <div class="notification-header">${this.type}</div>\n      <div class="notification-body">${this.message}</div>\n    </div>\n  </div>`}render(){const e=document.createElement("div");e.innerHTML=this.getTemplate(),this.element=e.firstElementChild,this.element.classList.add(this.type)}show(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body).append(this.element),n.isAlreadyShow=this.element;setTimeout(()=>this.remove(),this.duration);return this.element}remove(){this.element.remove()}destroy(){this.remove()}}},348:(e,t,s)=>{s.d(t,{Z:()=>a});var n=s(856),i=s(842);function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{data:t=[],sorted:s={id:e.find(e=>e.sortable).id,order:"asc"},isSortLocally:n=!1,url:a="",clickableString:l=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,"subElements",{}),r(this,"pageSize",30),r(this,"onWindowScroll",()=>{this.element.classList.contains("sortable-table_loading")||this.endOfData||this.isSortLocally||this.element.getBoundingClientRect().bottom<document.documentElement.clientHeight&&this.loadData(this.sorted.id,this.sorted.order).then(e=>{this.update(e,!1),this.element.classList.remove("sortable-table_loading")}).catch(e=>{new i.Z("Ошибка получения данных",{duration:2e3,type:"error"})})}),r(this,"handleClick",e=>{const t=e.target.closest('[data-sortable="true"]');if(!t)return;let s;switch(t.dataset.order){case"asc":s="desc";break;case"desc":s="asc";break;default:s="asc"}this.sort(t.dataset.id,s).then(e=>e)}),this.headerConfig=e,this.url="string"==typeof a?new URL(a,"https://course-js.javascript.ru/"):a,this.data=t,this.sorted=s,this.isSortLocally=n,this.clickableString=l,this.render().then(()=>this.initEventListeners())}getTemplate(){return'<div data-element="productsContainer" class="products-list__container">\n  <div class="sortable-table">\n  <div data-element="header" class="sortable-table__header sortable-table__row"></div>\n  <div data-element="body" class="sortable-table__body"></div>\n  <div><div>'}renderHeaders(e,t){const s=[];for(const n of this.headerConfig){let i="",r="";n.id===e&&(i='<span data-element="arrow" class="sortable-table__sort-arrow">\n        <span class="sort-arrow"></span>\n        </span>',r=t),s.push(`<div class="sortable-table__cell" data-id="${n.id}" data-sortable="${n.sortable}" data-order="${r}">\n      <span>${n.title}</span>${i}\n      </div>`)}return s.join("")}renderBody(e){const t=[];for(const s of e)t.push(`${this.clickableString?`<a href="/products/${s.id}" `:"<div "} class="sortable-table__row">\n        ${this.headerConfig.filter(e=>s[e.id]).map(e=>e.template?e.template(s[e.id]):`<div class="sortable-table__cell">${s[e.id]}</div>`).join("")}\n        ${this.clickableString?"</a>":"</div>"}`);return t.join("")}getSubElements(e){const t=e.querySelectorAll("[data-element]");for(const e of t)this.subElements[e.dataset.element]=e}async render(){const{id:e,order:t}=this.sorted,s=document.createElement("div");s.innerHTML=this.getTemplate(),this.element=s.firstElementChild,this.getSubElements(this.element),this.data=await this.loadData(e,t),this.getTable(e,t)}async loadData(e,t){this.url.searchParams.set("_sort",e),this.url.searchParams.set("_order",t),this.url.searchParams.set("_start",this.data.length),this.url.searchParams.set("_end",this.data.length+this.pageSize),this.element.classList.add("sortable-table_loading");const s=await(0,n.Z)(this.url);return this.endOfData=!s.length,this.element.classList.remove("sortable-table_loading"),s}update(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=document.createElement("div");this.data=[...this.data,...e],s.innerHTML=this.renderBody(e),t&&(this.subElements.body.innerHTML=""),this.subElements.body.append(...s.childNodes)}initEventListeners(){this.subElements.header.addEventListener("pointerdown",this.handleClick),document.addEventListener("scroll",this.onWindowScroll)}sortOnClient(e,t){const s={asc:-1,desc:1}[t],n=this.headerConfig.find(t=>t.id===e).sortType;this.data.sort((t,i)=>{switch(n){case"number":return s*(t[e]-i[e]);case"string":return s*t[e].localeCompare(i[e],["ru","en"]);default:return s*(t[e]-i[e])}}),this.getTable(e,t)}async sortOnServer(e,t){this.data=await this.loadData(e,t),this.getTable(e,t)}async sort(e,t){this.isSortLocally?this.sortOnClient(e,t):await this.sortOnServer(e,t)}getTable(e,t){this.subElements.header.innerHTML=this.renderHeaders(e,t),this.subElements.body.innerHTML=this.renderBody(this.data),this.element.classList.remove("sortable-table_loading")}remove(){this.element.remove()}destroy(){this.remove(),document.removeEventListener("scroll",this.onWindowScroll),this.subElements.header.removeEventListener("pointerdown",this.handleClick)}}},21:(e,t,s)=>{s.r(t),s.d(t,{default:()=>h});var n=s(856),i=s(348);function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class a{constructor(){let{min:e=100,max:t=200,formatValue:s=(e=>"$"+e),selected:n={from:e,to:t}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,"element",void 0),r(this,"subElements",{}),r(this,"onThumbPointerMove",e=>{e.preventDefault();const{left:t,right:s,width:n}=this.subElements.inner.getBoundingClientRect();if(this.dragging===this.subElements.thumbLeft){let s=(e.clientX-t+this.shiftX)/n;s<0&&(s=0),s*=100;const i=parseFloat(this.subElements.thumbRight.style.right);s+i>100&&(s=100-i),this.dragging.style.left=this.subElements.progress.style.left=s+"%",this.subElements.from.innerHTML=this.formatValue(this.getValue().from)}if(this.dragging===this.subElements.thumbRight){let t=(s-e.clientX-this.shiftX)/n;t<0&&(t=0),t*=100;const i=parseFloat(this.subElements.thumbLeft.style.left);i+t>100&&(t=100-i),this.dragging.style.right=this.subElements.progress.style.right=t+"%",this.subElements.to.innerHTML=this.formatValue(this.getValue().to)}}),r(this,"onThumbPointerUp",()=>{this.element.classList.remove("range-slider_dragging"),document.removeEventListener("pointermove",this.onThumbPointerMove),document.removeEventListener("pointerup",this.onThumbPointerUp),this.element.dispatchEvent(new CustomEvent("range-select",{detail:this.getValue(),bubbles:!0}))}),this.min=e,this.max=t,this.formatValue=s,this.selected=n,this.render()}get template(){const{from:e,to:t}=this.selected;return`<div class="range-slider">\n      <span data-element="from">${this.formatValue(e)}</span>\n      <div data-element="inner" class="range-slider__inner">\n        <span data-element="progress" class="range-slider__progress"></span>\n        <span data-element="thumbLeft" class="range-slider__thumb-left"></span>\n        <span data-element="thumbRight" class="range-slider__thumb-right"></span>\n      </div>\n      <span data-element="to">${this.formatValue(t)}</span>\n    </div>`}render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild,this.element.ondragstart=()=>!1,this.subElements=this.getSubElements(e),this.initEventListeners(),this.update()}initEventListeners(){const{thumbLeft:e,thumbRight:t}=this.subElements;e.addEventListener("pointerdown",e=>this.onThumbPointerDown(e)),t.addEventListener("pointerdown",e=>this.onThumbPointerDown(e))}getSubElements(e){const t={},s=e.querySelectorAll("[data-element]");for(const e of s){t[e.dataset.element]=e}return t}remove(){this.element.remove()}destroy(){this.remove(),document.removeEventListener("pointermove",this.onThumbPointerMove),document.removeEventListener("pointerup",this.onThumbPointerUp)}update(){const e=this.max-this.min,t=Math.floor((this.selected.from-this.min)/e*100)+"%",s=Math.floor((this.max-this.selected.to)/e*100)+"%";this.subElements.progress.style.left=t,this.subElements.progress.style.right=s,this.subElements.thumbLeft.style.left=t,this.subElements.thumbRight.style.right=s}onThumbPointerDown(e){const t=e.target;e.preventDefault();const{left:s,right:n}=t.getBoundingClientRect();t===this.subElements.thumbLeft?this.shiftX=n-e.clientX:this.shiftX=s-e.clientX,this.dragging=t,this.element.classList.add("range-slider_dragging"),document.addEventListener("pointermove",this.onThumbPointerMove),document.addEventListener("pointerup",this.onThumbPointerUp)}getValue(){const e=this.max-this.min,{left:t}=this.subElements.thumbLeft.style,{right:s}=this.subElements.thumbRight.style;return{from:Math.round(this.min+.01*parseFloat(t)*e),to:Math.round(this.max-.01*parseFloat(s)*e)}}}const l=[{id:"images",title:"Фото",sortable:!1,template:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return`\n          <div class="sortable-table__cell">\n            <img class="sortable-table-image" alt="Image" src="${e[0].url}">\n          </div>\n        `}},{id:"title",title:"Название",sortable:!0,sortType:"string"},{id:"subcategory",title:"Категория",sortable:!1,template:e=>`<div class="sortable-table__cell">\n                <span data-tooltip='<div class="sortable-table-tooltip"><span class="sortable-table-tooltip__category">${e.category.title+" / "}</span><b class="sortable-table-tooltip__subcategory">${e.title}</b></div>'>${e.title}</span>\n           </div>`},{id:"quantity",title:"Количество",sortable:!0,sortType:"number"},{id:"price",title:"Цена",sortable:!0,sortType:"number"},{id:"status",title:"Статус",sortable:!0,sortType:"number",template:e=>`<div class="sortable-table__cell">\n          ${e>0?"Active":"Inactive"}\n        </div>`}];function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class h{constructor(){o(this,"element",void 0),o(this,"subElements",{}),o(this,"components",{}),o(this,"start",0),o(this,"end",30),o(this,"url",new URL("api/rest/products?_embed=subcategory.category","https://course-js.javascript.ru/"))}async updateComponents(e,t){const s=await this.loadData(e,t);this.components.sortableTable.update(s)}loadData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.start,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.end;return this.url.searchParams.set("_start","0"),this.url.searchParams.set("_end","30"),this.url.searchParams.set("_sort","title"),this.url.searchParams.set("_order","asc"),this.url.searchParams.set("price_gte",e),this.url.searchParams.set("price_lte",t),this.components.sortableTable.endOfData=!1,this.components.sortableTable.url=this.url,this.components.sortableTable.data=[],(0,n.Z)(this.url)}initComponents(){const e=new a({min:1,max:4e3});this.url.searchParams.set("_start",this.start),this.url.searchParams.set("_end",this.end);const t=new i.Z(l,{url:this.url});this.components={sliderContainer:e,sortableTable:t}}get template(){return'<div class="products-list">\n              <div class="content__top-panel">\n                <h1 class="page-title">Товары</h1>\n                <a href="/products/add" class="button-primary">Добавить товар</a>\n              </div>\n              \n              <div class="content-box content-box_small">\n                <form class="form-inline">\n                  <div class="form-group">\n                    <label class="form-label">Сортировать по:</label>\n                    <input type="text" data-element="filterName" class="form-control" placeholder="Название товара">\n                  </div>\n                  \n                  <div class="form-group" data-element="sliderContainer">\n                    <label class="form-label">Цена:</label>\n                  </div>\n                  \n                  <div class="form-group">\n                      <label class="form-label">Статус:</label>\n                      <select class="form-control" data-element="filterStatus">\n                          <option value="" selected="">Любой</option>\n                          <option value="1">Активный</option>\n                          <option value="0">Неактивный</option>\n                      </select>\n                  </div>\n                </form>\n              </div>    \n                            \n              <div data-element="sortableTable">\n                  \x3c!-- sortable-table component --\x3e\n              </div>\n            </div>'}render(){const e=document.createElement("div");return e.innerHTML=this.template,this.element=e.firstElementChild,this.getSubElements(e),this.initComponents(),this.renderComponents(),this.initEventListeners(),this.element}renderComponents(){for(const e of Object.keys(this.components))this.subElements[e].append(this.components[e].element)}initEventListeners(){this.subElements.sliderContainer.addEventListener("range-select",e=>{const{from:t,to:s}=e.detail;this.updateComponents(t,s)}),this.subElements.filterName.addEventListener("input",e=>{this.url.searchParams.set("title_like",e.target.value),this.updateComponents()}),this.subElements.filterStatus.addEventListener("change",e=>{const t=[...e.target.options].find(e=>e.selected).value;t?this.url.searchParams.set("status",t):this.url.searchParams.delete("status"),this.updateComponents()})}getSubElements(e){const t=e.querySelectorAll("[data-element]");for(const e of t)this.subElements[e.dataset.element]=e}remove(){this.element.remove()}destroy(){this.subElements={};for(const e of Object.values(this.components))e.destroy();this.remove()}}},856:(e,t,s)=>{async function n(e,t){let s,n;try{s=await fetch(e.toString(),t)}catch(e){throw new i(s,"Network error has occurred.")}if(!s.ok){let e=s.statusText;try{n=await s.json(),e=n.error&&n.error.message||n.data&&n.data.error&&n.data.error.message||e}catch(e){}let t=`Error ${s.status}: ${e}`;throw new i(s,n,t)}try{return await s.json()}catch(e){throw new i(s,null,e.message)}}s.d(t,{Z:()=>n});class i extends Error{constructor(e,t,s){var n,i,r;super(s),r="FetchError",(i="name")in(n=this)?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof i&&alert(e.reason.message)})}}]);
//# sourceMappingURL=products-list-index-js-197.js.map