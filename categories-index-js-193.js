"use strict";(self.webpackChunkproject_structure=self.webpackChunkproject_structure||[]).push([[193],{842:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",{duration:t=1e3,type:s="success"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n,r,o;o=void 0,(r="element")in(n=this)?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,this.duration=t,this.message=e,this.type=s,this.render(),i.isAlreadyShow?i.isAlreadyShow.remove(i.isAlreadyShow):i.isAlreadyShow=!1}getTemplate(){return`<div class="notification" style="--value:2s">\n    <div class="timer"></div>\n    <div class="inner-wrapper">\n      <div class="notification-header">${this.type}</div>\n      <div class="notification-body">${this.message}</div>\n    </div>\n  </div>`}render(){const e=document.createElement("div");e.innerHTML=this.getTemplate(),this.element=e.firstElementChild,this.element.classList.add(this.type)}show(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body).append(this.element),i.isAlreadyShow=this.element;setTimeout(()=>this.remove(),this.duration);return this.element}remove(){this.element.remove()}destroy(){this.remove()}}},523:(e,t,s)=>{function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,{Z:()=>n});class n{constructor(){let{items:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,"onPointerDown",e=>{const t=e.target.closest(".sortable-list__item");t&&(e.target.closest("[data-grab-handle]")&&(e.preventDefault(),this.elMove=t,this.elShift=e.pageY-t.getBoundingClientRect().top,e.preventDefault(),this.dragStart(t,e)),e.target.closest("[data-delete-handle]")&&this.removeItem(t))}),i(this,"onDocumentPointerMove",e=>{this.moveDraggingAt(e.clientX,e.clientY),this.elMove.style.display="none";let t=document.elementFromPoint(e.clientX,e.clientY);if(this.elMove.style.display="",!t)return;const s=t.closest(".sortable-list__item");if(!t.closest(".sortable-list__placeholder")&&s){const e=[...this.element.children].indexOf(s);if(e>this.element.children.length||e<0)return;const t=s.getBoundingClientRect().top>this.placeholderElem.getBoundingClientRect().top?1:0;this.movePlaceholderAt(s,t)}}),i(this,"onDocumentPointerUp",()=>{this.dragStop()}),this.items=e,this.render()}render(){this.element=document.createElement("ul"),this.element.classList.add("sortable-list");for(const e of this.items)this.addItem(e);this.element.addEventListener("pointerdown",this.onPointerDown)}addItem(e){e.classList.add("sortable-list__item"),this.element.append(e)}removeItem(e){e.remove(),this.element.dispatchEvent(new CustomEvent("sortable-list-delete",{bubbles:!0,details:{item:e}}))}dragStart(e,t){let{clientX:s,clientY:i}=t;this.elementInitialIndex=[...this.element.children].indexOf(e),this.elShift={x:s-e.getBoundingClientRect().x,y:i-e.getBoundingClientRect().y},this.elMove=e,this.placeholderElem=document.createElement("div"),this.placeholderElem.className="sortable-list__placeholder",e.style.width=e.offsetWidth+"px",e.style.height=e.offsetHeight+"px",this.placeholderElem.style.width=e.style.width,this.placeholderElem.style.height=e.style.height,e.classList.add("sortable-list__item_dragging"),e.after(this.placeholderElem),this.element.append(e),this.moveDraggingAt(s,i),document.addEventListener("pointermove",this.onDocumentPointerMove),document.addEventListener("pointerup",this.onDocumentPointerUp)}moveDraggingAt(e,t){this.elMove.style.left=e-this.elShift.x+"px",this.elMove.style.top=t-this.elShift.y+"px"}movePlaceholderAt(e,t){t?e.after(this.placeholderElem):e.before(this.placeholderElem)}dragStop(){const e=[...this.element.children].indexOf(this.placeholderElem);this.placeholderElem.replaceWith(this.elMove),this.elMove.classList.remove("sortable-list__item_dragging"),this.elMove.style.width="",this.elMove.style.height="",this.elMove.style.left="",this.elMove.style.top="",this.placeholderElem.remove(),document.removeEventListener("pointermove",this.onDocumentPointerMove),document.removeEventListener("pointerup",this.onDocumentPointerUp),this.elMove=null,e!==this.elementInitialIndex&&this.element.dispatchEvent(new CustomEvent("sortable-list-reorder",{bubbles:!0,detail:{item:this.element}}))}remove(){this.element.remove()}destroy(){this.element.removeEventListener("pointerdown",this.onPointerDown),document.removeEventListener("pointermove",this.onDocumentPointerMove),document.removeEventListener("pointerup",this.onDocumentPointerUp),this.element.remove()}}},434:(e,t,s)=>{s.r(t),s.d(t,{default:()=>l});var i=s(856),n=s(523),r=s(842);function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class l{constructor(){o(this,"subElements",{}),o(this,"components",{}),o(this,"initClickHandle",e=>{e.target.closest(".category__header")&&e.target.closest(".category").classList.toggle("category_open")})}renderCategoriesForm(e){return e.map(e=>{const t=document.createElement("div");return t.innerHTML=`<div class="category category_open" data-id="${e.id}">\n                      <header class="category__header">\n                          ${e.title}\n                      </header>\n                      <div class="category__body">\n                          <div class="subcategory-list">\n                          </div>\n                      </div>\n                  </div>`,t.querySelector(".subcategory-list").append(this.renderSubcategories(e.subcategories)),t.firstElementChild})}renderSubcategories(e){const t=e.map(e=>{const t=document.createElement("div");return t.innerHTML=`<li class="categories__sortable-list-item" data-grab-handle="" data-id="${e.id}">\n                <strong>${e.title}</strong>\n                <span><b>${e.count}</b> products</span>`,t.firstElementChild});return new n.Z({items:t}).element}async loadData(){return await(0,i.Z)("https://course-js.javascript.ru/api/rest/categories?_sort=weight&_refs=subcategory")}get template(){return'<div class="categories">\n                <div class="content__top-panel">\n                    <h1 class="page-title">Категории товаров</h1>\n                </div>\n                <p>Подкатегории можно перетаскивать, меняя их порядок внутри своей категории.</p>\n                <div data-element="categoriesContainer">\n            \n                </div>\n            </div>'}async render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild,this.getSubElements(e);const t=await this.loadData();return this.subElements.categoriesContainer.append(...this.renderCategoriesForm(t)),this.initEventListeners(),this.element}getSubElements(e){const t=e.querySelectorAll("[data-element]");for(const e of t)this.subElements[e.dataset.element]=e}async saveOrder(e){let t=1;const s=[...e.querySelectorAll("[data-id]")].map(e=>({id:e.dataset.id,weight:t++}));try{const e=await(0,i.Z)("https://course-js.javascript.ru/api/rest/subcategories",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});console.log(e);new r.Z("Category order saved",{duration:2e3,type:"success"}).show()}catch(e){console.error("Ошибка в отправке формы",e)}}initEventListeners(){this.element.addEventListener("click",this.initClickHandle),this.element.addEventListener("sortable-list-reorder",e=>{this.saveOrder(e.detail.item)})}destroy(){this.subElements.categoriesContainer.removeEventListener("click",this.initClickHandle),this.subElements={};for(const e of Object.values(this.components))e.destroy()}}},856:(e,t,s)=>{async function i(e,t){let s,i;try{s=await fetch(e.toString(),t)}catch(e){throw new n(s,"Network error has occurred.")}if(!s.ok){let e=s.statusText;try{i=await s.json(),e=i.error&&i.error.message||i.data&&i.data.error&&i.data.error.message||e}catch(e){}let t=`Error ${s.status}: ${e}`;throw new n(s,i,t)}try{return await s.json()}catch(e){throw new n(s,null,e.message)}}s.d(t,{Z:()=>i});class n extends Error{constructor(e,t,s){var i,n,r;super(s),r="FetchError",(n="name")in(i=this)?Object.defineProperty(i,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[n]=r,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof n&&alert(e.reason.message)})}}]);
//# sourceMappingURL=categories-index-js-193.js.map