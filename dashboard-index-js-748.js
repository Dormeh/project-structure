"use strict";(self.webpackChunkproject_structure=self.webpackChunkproject_structure||[]).push([[748],{842:(e,t,s)=>{s.d(t,{Z:()=>a});class a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",{duration:t=1e3,type:s="success"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r,n,i;i=void 0,(n="element")in(r=this)?Object.defineProperty(r,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[n]=i,this.duration=t,this.message=e,this.type=s,this.render(),a.isAlreadyShow?a.isAlreadyShow.remove(a.isAlreadyShow):a.isAlreadyShow=!1}getTemplate(){return`<div class="notification" style="--value:2s">\n    <div class="timer"></div>\n    <div class="inner-wrapper">\n      <div class="notification-header">${this.type}</div>\n      <div class="notification-body">${this.message}</div>\n    </div>\n  </div>`}render(){const e=document.createElement("div");e.innerHTML=this.getTemplate(),this.element=e.firstElementChild,this.element.classList.add(this.type)}show(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body).append(this.element),a.isAlreadyShow=this.element;setTimeout(()=>this.remove(),this.duration);return this.element}remove(){this.element.remove()}destroy(){this.remove()}}},552:(e,t,s)=>{function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,{Z:()=>r});class r{static formatDate(e){return e.toLocaleString("ru",{dateStyle:"short"})}constructor(){let{from:e=new Date,to:t=new Date}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,"element",null),a(this,"subElements",{}),a(this,"selectingFrom",!0),a(this,"selected",{from:new Date,to:new Date}),a(this,"onDocumentClick",e=>{const t=this.element.classList.contains("rangepicker_open"),s=this.element.contains(e.target);t&&!s&&this.close()}),this.showDateFrom=new Date(e),this.selected={from:e,to:t},this.render()}get template(){return`<div class="rangepicker">\n      <div class="rangepicker__input" data-elem="input">\n        <span data-elem="from">${r.formatDate(this.selected.from)}</span> -\n        <span data-elem="to">${r.formatDate(this.selected.to)}</span>\n      </div>\n      <div class="rangepicker__selector" data-elem="selector"></div>\n    </div>`}render(){const e=document.createElement("div");return e.innerHTML=this.template,this.element=e.firstElementChild,this.subElements=this.getSubElements(e),this.initEventListeners(),Promise.resolve(this.element)}getSubElements(e){const t={};for(const s of e.querySelectorAll("[data-elem]"))t[s.dataset.elem]=s;return t}initEventListeners(){const{input:e,selector:t}=this.subElements;document.addEventListener("click",this.onDocumentClick,!0),e.addEventListener("click",()=>this.toggle()),t.addEventListener("click",e=>this.onSelectorClick(e))}toggle(){this.element.classList.toggle("rangepicker_open"),this.renderDateRangePicker()}onSelectorClick(e){let{target:t}=e;t.classList.contains("rangepicker__cell")&&this.onRangePickerCellClick(t)}close(){this.element.classList.remove("rangepicker_open")}renderDateRangePicker(){const e=new Date(this.showDateFrom),t=new Date(this.showDateFrom),{selector:s}=this.subElements;t.setMonth(t.getMonth()+1),s.innerHTML=`\n      <div class="rangepicker__selector-arrow"></div>\n      <div class="rangepicker__selector-control-left"></div>\n      <div class="rangepicker__selector-control-right"></div>\n      ${this.renderCalendar(e)}\n      ${this.renderCalendar(t)}\n    `;const a=s.querySelector(".rangepicker__selector-control-left"),r=s.querySelector(".rangepicker__selector-control-right");a.addEventListener("click",()=>this.prev()),r.addEventListener("click",()=>this.next()),this.renderHighlight()}prev(){this.showDateFrom.setMonth(this.showDateFrom.getMonth()-1),this.renderDateRangePicker()}next(){this.showDateFrom.setMonth(this.showDateFrom.getMonth()+1),this.renderDateRangePicker()}renderHighlight(){const{from:e,to:t}=this.selected;for(const s of this.element.querySelectorAll(".rangepicker__cell")){const{value:a}=s.dataset,r=new Date(a);s.classList.remove("rangepicker__selected-from"),s.classList.remove("rangepicker__selected-between"),s.classList.remove("rangepicker__selected-to"),e&&a===e.toISOString()?s.classList.add("rangepicker__selected-from"):t&&a===t.toISOString()?s.classList.add("rangepicker__selected-to"):e&&t&&r>=e&&r<=t&&s.classList.add("rangepicker__selected-between")}if(e){const t=this.element.querySelector(`[data-value="${e.toISOString()}"]`);t&&t.closest(".rangepicker__cell").classList.add("rangepicker__selected-from")}if(t){const e=this.element.querySelector(`[data-value="${t.toISOString()}"]`);e&&e.closest(".rangepicker__cell").classList.add("rangepicker__selected-to")}}renderCalendar(e){const t=new Date(e);t.setDate(1);const s=t.toLocaleString("ru",{month:"long"});let a=`<div class="rangepicker__calendar">\n      <div class="rangepicker__month-indicator">\n        <time datetime=${s}>${s}</time>\n      </div>\n      <div class="rangepicker__day-of-week">\n        <div>Пн</div><div>Вт</div><div>Ср</div><div>Чт</div><div>Пт</div><div>Сб</div><div>Вс</div>\n      </div>\n      <div class="rangepicker__date-grid">\n    `;var r;for(a+=`\n      <button type="button"\n        class="rangepicker__cell"\n        data-value="${t.toISOString()}"\n        style="--start-from: ${r=t.getDay(),1+(0===r?6:r-1)}">\n          ${t.getDate()}\n      </button>`,t.setDate(2);t.getMonth()===e.getMonth();)a+=`\n        <button type="button"\n          class="rangepicker__cell"\n          data-value="${t.toISOString()}">\n            ${t.getDate()}\n        </button>`,t.setDate(t.getDate()+1);return a+="</div></div>",a}onRangePickerCellClick(e){const{value:t}=e.dataset;if(t){const e=new Date(t);this.selectingFrom?(this.selected={from:e,to:null},this.selectingFrom=!1,this.renderHighlight()):(e>this.selected.from?this.selected.to=e:(this.selected.to=this.selected.from,this.selected.from=e),this.selectingFrom=!0,this.renderHighlight()),this.selected.from&&this.selected.to&&(this.dispatchEvent(),this.close(),this.subElements.from.innerHTML=r.formatDate(this.selected.from),this.subElements.to.innerHTML=r.formatDate(this.selected.to))}}dispatchEvent(){this.element.dispatchEvent(new CustomEvent("date-select",{bubbles:!0,detail:this.selected}))}remove(){this.element.remove(),document.removeEventListener("click",this.onDocumentClick,!0)}destroy(){return this.remove(),this.element=null,this.subElements={},this.selectingFrom=!0,this.selected={from:new Date,to:new Date},this}}},348:(e,t,s)=>{s.d(t,{Z:()=>i});var a=s(856),r=s(842);function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{data:t=[],sorted:s={id:e.find(e=>e.sortable).id,order:"asc"},isSortLocally:a=!1,url:i="",clickableString:l=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,"subElements",{}),n(this,"pageSize",30),n(this,"onWindowScroll",()=>{this.element.classList.contains("sortable-table_loading")||this.endOfData||this.isSortLocally||this.element.getBoundingClientRect().bottom<document.documentElement.clientHeight&&this.loadData(this.sorted.id,this.sorted.order).then(e=>{this.update(e,!1),this.element.classList.remove("sortable-table_loading")}).catch(e=>{new r.Z("Ошибка получения данных",{duration:2e3,type:"error"})})}),n(this,"handleClick",e=>{const t=e.target.closest('[data-sortable="true"]');if(!t)return;let s;switch(t.dataset.order){case"asc":s="desc";break;case"desc":s="asc";break;default:s="asc"}this.sort(t.dataset.id,s).then(e=>e)}),this.headerConfig=e,this.url="string"==typeof i?new URL(i,"https://course-js.javascript.ru/"):i,this.data=t,this.sorted=s,this.isSortLocally=a,this.clickableString=l,this.render().then(()=>this.initEventListeners())}getTemplate(){return'<div data-element="productsContainer" class="products-list__container">\n  <div class="sortable-table">\n  <div data-element="header" class="sortable-table__header sortable-table__row"></div>\n  <div data-element="body" class="sortable-table__body"></div>\n  <div><div>'}renderHeaders(e,t){const s=[];for(const a of this.headerConfig){let r="",n="";a.id===e&&(r='<span data-element="arrow" class="sortable-table__sort-arrow">\n        <span class="sort-arrow"></span>\n        </span>',n=t),s.push(`<div class="sortable-table__cell" data-id="${a.id}" data-sortable="${a.sortable}" data-order="${n}">\n      <span>${a.title}</span>${r}\n      </div>`)}return s.join("")}renderBody(e){const t=[];for(const s of e)t.push(`${this.clickableString?`<a href="/products/${s.id}" `:"<div "} class="sortable-table__row">\n        ${this.headerConfig.filter(e=>s[e.id]).map(e=>e.template?e.template(s[e.id]):`<div class="sortable-table__cell">${s[e.id]}</div>`).join("")}\n        ${this.clickableString?"</a>":"</div>"}`);return t.join("")}getSubElements(e){const t=e.querySelectorAll("[data-element]");for(const e of t)this.subElements[e.dataset.element]=e}async render(){const{id:e,order:t}=this.sorted,s=document.createElement("div");s.innerHTML=this.getTemplate(),this.element=s.firstElementChild,this.getSubElements(this.element),this.data=await this.loadData(e,t),this.getTable(e,t)}async loadData(e,t){this.url.searchParams.set("_sort",e),this.url.searchParams.set("_order",t),this.url.searchParams.set("_start",this.data.length),this.url.searchParams.set("_end",this.data.length+this.pageSize),this.element.classList.add("sortable-table_loading");const s=await(0,a.Z)(this.url);return this.endOfData=!s.length,this.element.classList.remove("sortable-table_loading"),s}update(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=document.createElement("div");this.data=[...this.data,...e],s.innerHTML=this.renderBody(e),t&&(this.subElements.body.innerHTML=""),this.subElements.body.append(...s.childNodes)}initEventListeners(){this.subElements.header.addEventListener("pointerdown",this.handleClick),document.addEventListener("scroll",this.onWindowScroll)}sortOnClient(e,t){const s={asc:-1,desc:1}[t],a=this.headerConfig.find(t=>t.id===e).sortType;this.data.sort((t,r)=>{switch(a){case"number":return s*(t[e]-r[e]);case"string":return s*t[e].localeCompare(r[e],["ru","en"]);default:return s*(t[e]-r[e])}}),this.getTable(e,t)}async sortOnServer(e,t){this.data=await this.loadData(e,t),this.getTable(e,t)}async sort(e,t){this.isSortLocally?this.sortOnClient(e,t):await this.sortOnServer(e,t)}getTable(e,t){this.subElements.header.innerHTML=this.renderHeaders(e,t),this.subElements.body.innerHTML=this.renderBody(this.data),this.element.classList.remove("sortable-table_loading")}remove(){this.element.remove()}destroy(){this.remove(),document.removeEventListener("scroll",this.onWindowScroll),this.subElements.header.removeEventListener("pointerdown",this.handleClick)}}},329:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var a=s(552),r=s(348),n=s(856);function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class l{constructor(){let{label:e="",link:t="",formatHeading:s=(e=>e),url:a="",range:r={from:new Date,to:new Date}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,"chartHeight",50),i(this,"subElements",{}),this.url=new URL(a,"https://course-js.javascript.ru/"),this.range=r,this.label=e,this.linkTemplate=t?`<a href="${t}" class="column-chart__link">View all</a>`:"",this.formatHeading=s,this.render(),this.update(this.range.from,this.range.to)}getTemplate(){return`<div class="column-chart column-chart_loading" style="--chart-height: ${this.chartHeight}">\n      <div class="column-chart__title">\n        ${this.label}\n        ${this.linkTemplate}\n      </div>\n      <div class="column-chart__container">\n        <div data-element="header" class="column-chart__header">${this.formatHeading}</div>\n        <div data-element="body" class="column-chart__chart">`}render(){const e=document.createElement("div");e.innerHTML=this.getTemplate(),this.element=e.firstElementChild,this.getSubElements(this.element)}getSubElements(e){const t=e.querySelectorAll("[data-element]");for(const e of t)this.subElements[e.dataset.element]=e}getColumnBody(){const e=Math.max(...Object.values(this.data));this.chartHeight;return Object.entries(this.data).map(t=>{let[s,a]=t;const r=this.chartHeight/e,n=(a/e*100).toFixed(0);return`<div style="--value: ${Math.floor(a*r)}" \n              data-tooltip="<div><small>${new Date(s).toLocaleString("default",{dateStyle:"medium"})}</small></div><strong>${n}%</strong>"></div>`}).join("")}async loadData(e,t){return this.url.searchParams.set("from",e.toISOString()),this.url.searchParams.set("to",t.toISOString()),await(0,n.Z)(this.url)}async update(e,t){const s=await this.loadData(e,t);if(this.data=s,!Object.values(s))return this.element.classList.add("column-chart_loading"),s;this.element.classList.remove("column-chart_loading");const a=Object.values(s).reduce((e,t)=>e+t,0);return this.subElements.body.innerHTML=this.getColumnBody(),this.subElements.header.textContent=this.formatHeading(a),s}remove(){this.element.remove()}destroy(){this.remove()}}const o=[{id:"images",title:"Фото",sortable:!1,template:e=>`\n          <div class="sortable-table__cell">\n            <img class="sortable-table-image" alt="Image" src="${e[0].url}">\n          </div>\n        `},{id:"title",title:"Название",sortable:!0,sortType:"string"},{id:"subcategory",title:"Категория",sortable:!1,template:e=>`<div class="sortable-table__cell">\n                <span data-tooltip='<div class="sortable-table-tooltip"><span class="sortable-table-tooltip__category">${e.category.title+" / "}</span><b class="sortable-table-tooltip__subcategory">${e.title}</b></div>'>${e.title}</span>\n           </div>`},{id:"quantity",title:"Количество",sortable:!0,sortType:"number"},{id:"price",title:"Цена",sortable:!0,sortType:"number"},{id:"status",title:"Статус",sortable:!0,sortType:"number",template:e=>`<div class="sortable-table__cell">\n          ${e>0?"Active":"Inactive"}\n        </div>`}];function c(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class d{constructor(){c(this,"element",void 0),c(this,"subElements",{}),c(this,"components",{}),c(this,"url",new URL("api/dashboard/bestsellers","https://course-js.javascript.ru/"))}async updateComponents(e,t){const s=await this.loadData(e,t);this.components.sortableTable.update(s),this.components.ordersChart.update(e,t),this.components.salesChart.update(e,t),this.components.customersChart.update(e,t)}loadData(e,t){return this.url.searchParams.set("_start","0"),this.url.searchParams.set("_end","30"),this.url.searchParams.set("_sort","title"),this.url.searchParams.set("_order","asc"),this.url.searchParams.set("from",e.toISOString()),this.url.searchParams.set("to",t.toISOString()),(0,n.Z)(this.url)}initComponents(){const e=new Date,t={from:new Date(e.setMonth(e.getMonth()-1)),to:new Date},s=new a.Z(t),n=new l({url:"api/dashboard/orders",range:t,label:"Заказы",link:"#"}),i=new l({url:"/api/dashboard/sales",label:"Продажи",range:t,formatHeading:e=>e.toLocaleString("en-US",{style:"currency",currency:"USD"}).slice(0,-3)}),c=new l({url:"/api/dashboard/customers",label:"Клиенты",range:t}),d=new r.Z(o,{url:`api/dashboard/bestsellers?_start=1&_end=20&from=${t.from.toISOString()}&to=${t.to.toISOString()}`,isSortLocally:!0});this.components={rangePicker:s,ordersChart:n,salesChart:i,customersChart:c,sortableTable:d}}get template(){return'<div class="dashboard">\n      <div class="content__top-panel">\n        <h2 class="page-title">Панель управления</h2>\n        \x3c!-- RangePicker component --\x3e\n        <div data-element="rangePicker"></div>\n      </div>\n      <div data-element="chartsRoot" class="dashboard__charts">\n        \x3c!-- column-chart components --\x3e\n        <div data-element="ordersChart" class="dashboard__chart_orders"></div>\n        <div data-element="salesChart" class="dashboard__chart_sales"></div>\n        <div data-element="customersChart" class="dashboard__chart_customers"></div>\n      </div>\n      <h3 class="block-title">Лидеры продаж</h3>\n      <div data-element="sortableTable">\n        \x3c!-- sortable-table component --\x3e\n      </div>\n    </div>'}render(){const e=document.createElement("div");return e.innerHTML=this.template,this.element=e.firstElementChild,this.getSubElements(e),this.initComponents(),this.renderComponents(),this.initEventListeners(),this.element}renderComponents(){for(const e of Object.keys(this.components))this.subElements[e].append(this.components[e].element)}initEventListeners(){this.components.rangePicker.element.addEventListener("date-select",e=>{const{from:t,to:s}=e.detail;this.updateComponents(t,s)})}getSubElements(e){const t=e.querySelectorAll("[data-element]");for(const e of t)this.subElements[e.dataset.element]=e}remove(){this.element.remove()}destroy(){this.subElements={};for(const e of Object.values(this.components))e.destroy();this.remove()}}},856:(e,t,s)=>{async function a(e,t){let s,a;try{s=await fetch(e.toString(),t)}catch(e){throw new r(s,"Network error has occurred.")}if(!s.ok){let e=s.statusText;try{a=await s.json(),e=a.error&&a.error.message||a.data&&a.data.error&&a.data.error.message||e}catch(e){}let t=`Error ${s.status}: ${e}`;throw new r(s,a,t)}try{return await s.json()}catch(e){throw new r(s,null,e.message)}}s.d(t,{Z:()=>a});class r extends Error{constructor(e,t,s){var a,r,n;super(s),n="FetchError",(r="name")in(a=this)?Object.defineProperty(a,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[r]=n,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof r&&alert(e.reason.message)})}}]);
//# sourceMappingURL=dashboard-index-js-748.js.map