{"version":3,"sources":["webpack://project-structure/./src/components/notification/index.js","webpack://project-structure/./src/components/sortable-list/index.js","webpack://project-structure/./src/utils/escape-html.js","webpack://project-structure/./src/components/product-form/index.js","webpack://project-structure/./src/pages/products/edit/index.js","webpack://project-structure/./src/utils/fetch-json.js"],"names":["NotificationMessage","constructor","message","duration","type","this","render","isAlreadyShow","remove","getTemplate","element","document","createElement","innerHTML","firstElementChild","classList","add","show","body","append","setTimeout","destroy","SortableList","items","event","target","closest","preventDefault","elMove","elShift","pageY","getBoundingClientRect","top","dragStart","removeItem","moveDraggingAt","clientX","clientY","style","display","elemBelow","elementFromPoint","elFromList","placeHoldIndex","children","indexOf","length","direction","placeholderElem","movePlaceholderAt","dragStop","elem","addItem","addEventListener","onPointerDown","dispatchEvent","CustomEvent","bubbles","details","item","elementInitialIndex","x","y","className","width","offsetWidth","height","offsetHeight","after","onDocumentPointerMove","onDocumentPointerUp","left","before","placeholderIndex","replaceWith","removeEventListener","detail","string","replace","ProductForm","productId","title","description","quantity","subcategory","status","images","price","discount","save","fileInput","accept","onchange","async","file","files","result","formData","FormData","subElements","productForm","uploadImage","disabled","fetchJson","method","headers","Authorization","referrer","error","Error","push","url","data","link","source","name","imageList","renderImageElem","hidden","appendChild","click","template","createCategoriesSelect","defaultFormData","categoriesPromise","loadCategoriesList","productPromise","loadProductData","Promise","resolve","categoriesData","productResponse","all","productData","categories","renderForm","setFormData","initEventListeners","qetEmptyTemplate","getSubElements","createImagesList","imageListContainer","productCategory","optionProduct","options","find","value","selected","arr","querySelectorAll","dataset","map","subcategories","id","join","product","getFormData","JSON","stringify","console","parseInt","onSubmit","liEl","escapeHtml","Page","match","URL","process","initComponents","components","component","Object","values","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","super","window","reason","alert"],"mappings":"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","file":"products-edit-index-js-460.js","sourcesContent":["export default class NotificationMessage {\n  element;\n  constructor(message = '', {\n    duration = 1000,\n    type = 'success',\n  } = {}) {\n    this.duration = duration;\n    this.message = message;\n    this.type = type;\n    this.render();\n    if (NotificationMessage.isAlreadyShow) {\n      NotificationMessage.isAlreadyShow.remove(NotificationMessage.isAlreadyShow);\n    } else {\n      NotificationMessage.isAlreadyShow = false;\n    }\n  }\n  getTemplate () {\n    return `<div class=\"notification\" style=\"--value:2s\">\n    <div class=\"timer\"></div>\n    <div class=\"inner-wrapper\">\n      <div class=\"notification-header\">${this.type}</div>\n      <div class=\"notification-body\">${this.message}</div>\n    </div>\n  </div>`;\n  }\n  render() {\n    const element = document.createElement('div'); // (*)\n    element.innerHTML = this.getTemplate();\n    this.element = element.firstElementChild;\n    this.element.classList.add(this.type);\n  }\n  show(element = document.body) {\n    element.append(this.element);\n    NotificationMessage.isAlreadyShow = this.element;\n    const timer = setTimeout(() => this.remove(), this.duration);\n    return this.element;\n  }\n  remove() {\n    this.element.remove();\n  }\n  destroy() {\n    this.remove();\n  }\n}\n","export default class SortableList {\n  constructor({\n    items = []\n  } = {}) {\n    this.items = items;\n    this.render();\n  }\n  render() {\n    this.element = document.createElement(\"ul\");\n    this.element.classList.add('sortable-list');\n    for (const elem of this.items) {\n      this.addItem(elem);\n    }\n    this.element.addEventListener('pointerdown', this.onPointerDown);\n  }\n  onPointerDown = (event) => {\n    const element = event.target.closest('.sortable-list__item');\n    if (!element) return;\n    if (event.target.closest('[data-grab-handle]')) {\n      event.preventDefault();\n      this.elMove = element;\n      this.elShift = event.pageY - element.getBoundingClientRect().top;\n      event.preventDefault();\n      this.dragStart(element, event);\n    }\n    if (event.target.closest(\"[data-delete-handle]\")) {\n      this.removeItem(element);\n    }\n  };\n  addItem(elem) {\n    elem.classList.add(\"sortable-list__item\");\n    this.element.append(elem);\n  }\n  removeItem(element) {\n    element.remove();\n    this.element.dispatchEvent(new CustomEvent(\"sortable-list-delete\", {\n      bubbles: true,\n      details: {\n        item: element\n      }\n    }))\n  }\n  dragStart(element, {clientX, clientY}) {\n    this.elementInitialIndex = [...this.element.children].indexOf(element);\n    this.elShift = {\n      x: clientX - element.getBoundingClientRect().x,\n      y: clientY - element.getBoundingClientRect().y\n    };\n    this.elMove = element;\n    this.placeholderElem = document.createElement(\"div\");\n    this.placeholderElem.className = \"sortable-list__placeholder\";\n    element.style.width = element.offsetWidth + \"px\";\n    element.style.height = element.offsetHeight + \"px\";\n    this.placeholderElem.style.width = element.style.width;\n    this.placeholderElem.style.height = element.style.height;\n    element.classList.add(\"sortable-list__item_dragging\");\n    element.after(this.placeholderElem);\n    this.element.append(element);\n    this.moveDraggingAt(clientX, clientY);\n    document.addEventListener(\"pointermove\", this.onDocumentPointerMove);\n    document.addEventListener(\"pointerup\", this.onDocumentPointerUp);\n  }\n  moveDraggingAt(x, y) {\n    this.elMove.style.left = x - this.elShift.x + \"px\";\n    this.elMove.style.top = y - this.elShift.y + \"px\";\n  }\n  onDocumentPointerMove = (event) => {\n    this.moveDraggingAt(event.clientX, event.clientY);\n    this.elMove.style.display = 'none';\n    let elemBelow = document.elementFromPoint(event.clientX, event.clientY);\n    this.elMove.style.display = '';\n    if (!elemBelow) return;\n    const elFromList = elemBelow.closest('.sortable-list__item');\n    if (!elemBelow.closest('.sortable-list__placeholder') && elFromList) {\n      const placeHoldIndex = [...this.element.children].indexOf(elFromList);\n      if (placeHoldIndex > this.element.children.length || placeHoldIndex < 0) return;\n      const direction = elFromList.getBoundingClientRect().top > this.placeholderElem.getBoundingClientRect().top\n        ? 1 : 0;\n      this.movePlaceholderAt(elFromList, direction);\n    }\n  };\n  movePlaceholderAt(elFromList, direction) {\n    direction ? elFromList.after(this.placeholderElem) : elFromList.before(this.placeholderElem);\n\n  }\n  onDocumentPointerUp = () => {\n    this.dragStop();\n  };\n\n  dragStop () {\n    const placeholderIndex = [...this.element.children].indexOf(this.placeholderElem);\n    this.placeholderElem.replaceWith(this.elMove);\n    this.elMove.classList.remove('sortable-list__item_dragging');\n    this.elMove.style.width = '';\n    this.elMove.style.height = '';\n    this.elMove.style.left = '';\n    this.elMove.style.top = '';\n    this.placeholderElem.remove();\n    document.removeEventListener(\"pointermove\", this.onDocumentPointerMove);\n    document.removeEventListener(\"pointerup\", this.onDocumentPointerUp);\n    this.elMove = null;\n    if (placeholderIndex !== this.elementInitialIndex) {\n      this.element.dispatchEvent(new CustomEvent('sortable-list-reorder', {\n        bubbles: true,\n        detail: {\n          item: this.element,\n        }\n      }));\n    }\n  }\n\n  remove () {\n    this.element.remove();\n  }\n\n  destroy() {\n    this.element.removeEventListener('pointerdown', this.onPointerDown);\n    document.removeEventListener(\"pointermove\", this.onDocumentPointerMove);\n    document.removeEventListener(\"pointerup\", this.onDocumentPointerUp);\n    this.element.remove();\n  }\n}\n","export default string => string\r\n  .replace(/&/g, '&amp;')\r\n  .replace(/\"/g, '&quot;')\r\n  .replace(/'/g, '&#39;')\r\n  .replace(/</g, '&lt;')\r\n  .replace(/>/g, '&gt;');\r\n","import SortableList from '../sortable-list/index.js';\nimport escapeHtml from '../../utils/escape-html.js';\nimport fetchJson from '../../utils/fetch-json.js';\nimport { log } from 'webpack-dev-server/client/utils/log';\n\nconst IMGUR_CLIENT_ID = process.env.IMGUR_CLIENT_ID;\nconst BACKEND_URL = process.env.BACKEND_URL;\n\nexport default class ProductForm {\n  subElements = {};\n  defaultFormData = [{\n    title: '',\n    description: '',\n    quantity: 1,\n    subcategory: '',\n    status: 1,\n    images: [],\n    price: 100,\n    discount: 0,\n  }];\n  constructor (productId) {\n    this.productId = productId;\n  }\n\n  onSubmit = event => {\n    event.preventDefault();\n\n    this.save();\n  };\n\n  template() {\n    return `<div class=\"products-edit\">\n      <div class=\"content__top-panel\">\n        <h1 class=\"page-title\">\n          <a href=\"/products\" class=\"link\">Товары</a> / ${this.productId ? \"Редактировать\" : \"Добавить\"}\n        </h1>\n      </div>\n      <div class=\"content-box\">\n\n    <div class=\"product-form\">\n    \n    <form data-element=\"productForm\" class=\"form-grid\">\n      <div class=\"form-group form-group__half_left\">\n        <fieldset>\n          <label class=\"form-label\">Название товара</label>\n          <input required=\"\" type=\"text\" name=\"title\" class=\"form-control\" placeholder=\"Название товара\">\n        </fieldset>\n      </div>\n      \n      <div class=\"form-group form-group__wide\">\n        <label class=\"form-label\">Описание</label>\n        <textarea required=\"\" class=\"form-control\" name=\"description\" data-element=\"productDescription\" placeholder=\"Описание товара\"></textarea>\n      </div>\n      \n      <div class=\"form-group form-group__wide\" data-element=\"sortable-list-container\">\n        <label class=\"form-label\">Фото</label>\n\n        <div data-element=\"imageListContainer\">\n        </\\div>\n\n        <button type=\"button\" name=\"uploadImage\" class=\"button-primary-outline fit-content\"><span>Загрузить</span></button>\n      </div>\n      \n      <div class=\"form-group form-group__half_left\">\n        <label class=\"form-label\">Категория</label>\n        <select class=\"form-control\" name=\"subcategory\">\n            ${this.createCategoriesSelect()}\n        </select>\n      </div>\n      \n      <div class=\"form-group form-group__half_left form-group__two-col\">\n        <fieldset>\n          <label class=\"form-label\">Цена ($)</label>\n          <input required=\"\" type=\"number\" name=\"price\" class=\"form-control\" placeholder=\"${this.defaultFormData.price}\">\n        </fieldset>\n        <fieldset>\n          <label class=\"form-label\">Скидка ($)</label>\n          <input required=\"\" type=\"number\" name=\"discount\" class=\"form-control\" placeholder=\"${this.defaultFormData.discount}\">\n        </fieldset>\n      </div>\n      \n      <div class=\"form-group form-group__part-half\">\n        <label class=\"form-label\">Количество</label>\n        <input required=\"\" type=\"number\" class=\"form-control\" name=\"quantity\" placeholder=\"${this.defaultFormData.quantity}\">\n      </div>\n      <div class=\"form-group form-group__part-half\">\n        <label class=\"form-label\">Статус</label>\n        <select class=\"form-control\" name=\"status\">\n          <option value=\"1\">Активен</option>\n          <option value=\"0\">Неактивен</option>\n        </select>\n      </div>\n      <div class=\"form-buttons\">\n        <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\n          ${this.productId ? \"Сохранить\" : \"Добавить\"} товар\n        </button>\n      </div>\n    </form>\n  </div>\n  </div>\n`;\n  }\n\n  async render () {\n    const categoriesPromise = this.loadCategoriesList();\n    const productPromise = this.productId\n      ? this.loadProductData(this.productId)\n      : Promise.resolve(this.defaultFormData);\n    const [categoriesData, productResponse] = await Promise.all([categoriesPromise, productPromise]);\n    const [productData] = productResponse;\n\n    this.formData = productData;\n    this.categories = categoriesData;\n    this.renderForm();\n    if (this.formData) {\n      this.setFormData();\n      this.initEventListeners();\n      return this.element;\n    }\n  }\n  renderForm() {\n    const element = document. createElement('div');\n    element.innerHTML = this.formData\n      ? this.template()\n      : this.qetEmptyTemplate();\n    this.element = element.firstElementChild;\n\n    this.getSubElements(element);\n    const items = this.createImagesList();\n    this.imageList = new SortableList({items});\n    this.subElements.imageListContainer.append(this.imageList.element);\n    const productCategory = this.formData.subcategory;\n    const selectArr = this.subElements.productForm.subcategory.options;\n    const optionProduct = [...selectArr].find(elem => {\n      return elem.value === productCategory;\n    });\n    if ( optionProduct ) {\n      optionProduct.selected = true;\n    }\n  }\n  qetEmptyTemplate() {\n    return `<div class=\"error-404\">\n      <h1 class=\"page-title\">Страница не найдена</h1>\n      <p>Извините, страница не существует</p>\n    </div>`;\n  }\n  getSubElements(element) {\n    const arr = element.querySelectorAll('[data-element]');\n    for (const elem of arr) {\n      this.subElements[elem.dataset.element] = elem;\n    }\n  }\n\n  async loadProductData() {\n    return fetchJson(`https://course-js.javascript.ru/api/rest/products?id=${this.productId}`);\n  }\n\n  async loadCategoriesList() {\n    return fetchJson(\"https://course-js.javascript.ru/api/rest/categories?_sort=weight&_refs=subcategory\");\n\n  }\n\n  setFormData() {\n    const {title, description, price, discount, quantity, status} = this.formData;\n    this.subElements.productForm.title.value = title;\n    this.subElements.productForm.description.value = description;\n    this.subElements.productForm.price.value = price;\n    this.subElements.productForm.discount.value = discount;\n    this.subElements.productForm.quantity.value = quantity;\n    this.subElements.productForm.status.value = status;\n  }\n  createCategoriesSelect() {\n    return this.categories.map(elem => elem.subcategories\n      .map(item => {\n        return `<option value=\"${item.id}\">${elem.title} > ${item.title}</option>`;\n      })\n      .join(''))\n      .join('');\n\n  }\n\n  async save() {\n    const product = this.getFormData();\n\n    try {\n      const result = await fetchJson(`${BACKEND_URL}/api/rest/products`,\n        {\n          method: this.productId ? 'PATCH' : 'PUT',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(product)\n        });\n\n      const event = this.productId ? new CustomEvent(\"product-saved\", {detail: result.id}) : new CustomEvent(\"product-updated\", {detail: result.id});\n      this.element.dispatchEvent(event);\n\n    } catch (error) {\n      console.error('Ошибка в отправке формы', error);\n    }\n  }\n\n  getFormData() {\n    const {productForm} = this.subElements;\n    const {title, description, subcategory, price, quantity, discount, status} = productForm;\n    return {\n      id: this.productId,\n      title: title.value,\n      description: description.value,\n      subcategory: subcategory.value,\n      price: parseInt(price.value, 10),\n      quantity: parseInt(quantity.value, 10),\n      discount: parseInt(discount.value, 10),\n      status: parseInt(status.value, 10),\n      images: this.formData.images\n    };\n\n  }\n\n  initEventListeners() {\n    const {productForm, imageListContainer} = this.subElements;\n\n    productForm.addEventListener('submit', this.onSubmit);\n\n    productForm.uploadImage.addEventListener('click', this.uploadImage) ;\n\n    imageListContainer.addEventListener('click', event => {\n      if ('deleteHandle' in event.target.dataset)\n        event.target.closest('li').remove();\n    });\n  }\n  uploadImage = () => {\n    const fileInput = document.createElement(\"input\");\n    fileInput.type = \"file\";\n    fileInput.accept = \"image/*\";\n    fileInput.onchange = async()=>{\n      const [file] = fileInput.files;\n      if (!file)\n        return;\n      let result; const formData = new FormData();\n      formData.append(\"image\", file);\n      this.subElements.productForm.uploadImage.classList.add(\"is-loading\");\n      this.subElements.productForm.uploadImage.disabled = true;\n\n      try {\n        result = await fetchJson(\"https://api.imgur.com/3/image\", {\n          method: \"POST\",\n          headers: {\n            Authorization: `Client-ID ${IMGUR_CLIENT_ID}`\n          },\n          body: formData,\n          referrer: ''\n        });\n      } catch (error) {\n        return new Error(\"Upload error: \" + error.message);\n      } finally {\n        this.subElements.productForm.uploadImage.classList.remove(\"is-loading\");\n        this.subElements.productForm.uploadImage.disabled = false;\n      }\n\n      this.formData.images.push({url: result.data.link, source: file.name});\n      this.imageList.addItem(this.renderImageElem({\n        url: result.data.link,\n        source: file.name\n      }));\n    };\n    fileInput.hidden = true;\n    document.body.appendChild(fileInput);\n    fileInput.click();\n  };\n\n  createImagesList() {\n    if (!this.formData)\n      return '';\n    return this.formData.images.map(item => this.renderImageElem(item));\n  }\n  renderImageElem ({url, source}) {\n    const liEl = document.createElement('li');\n    liEl.classList.add('products-edit__imagelist-item');\n    liEl.innerHTML = `<input type=\"hidden\" name=\"url\" value=\"${url}\">\n                    <input type=\"hidden\" name=\"source\" value=\"${source}\">\n      <span>\n      <img src=\"/assets/icons/icon-grab.svg\" data-grab-handle alt=\"grab\">\n      <img class=\"sortable-table__cell-img\" alt=\"Image\" src=\"${escapeHtml(url)}\">\n      <span>${escapeHtml(source)}</span>\n      </span>\n      <button type=\"button\">\n      <img src=\"/assets/icons/icon-trash.svg\" data-delete-handle alt=\"delete\">\n      </button>`;\n    return liEl;\n  }\n\n  remove () {\n    this.element.remove();\n  }\n\n  destroy() {\n    const {productForm} = this.subElements;\n    productForm.uploadImage.removeEventListener('click', this.uploadImage);\n    productForm.removeEventListener('submit', this.onSubmit);\n    this.remove();\n  }\n}\n","import ProductForm from '../../../components/product-form/index.js';\nimport NotificationMessage from '../../../components/notification/index.js'\n\nconst BACKEND_URL = process.env.BACKEND_URL;\n\nexport default class Page {\n  subElements = {};\n  components = {};\n  url = new URL('api/dashboard/bestsellers', BACKEND_URL);\n  constructor(\n    match = ''\n  ){\n    this.productId = match.replace(/products\\/(.+)/, (...match) => {\n      return match[1] !== 'add' ? match[1] : ''\n    });\n  }\n  initComponents() {\n    const productForm = new ProductForm(this.productId);\n\n    this.components = {\n      productForm,\n    };\n  }\n\n  async render() {\n    this.initComponents();\n    await this.components.productForm.render();\n    this.initEventListeners();\n    return this.components.productForm.element;\n  }\n\n  initEventListeners() {\n    this.components.productForm.element.addEventListener('product-saved', event => {\n      console.error('product-saved', event.detail);\n      const notification = new NotificationMessage('Товар сохранен', {\n        duration: 2000,\n        type: 'success'\n      });\n\n      notification.show();\n    });\n\n    this.components.productForm.element.addEventListener('product-updated', event => {\n      console.error('product-updated', event.detail);\n      const notification = new NotificationMessage('Товар добавлен', {\n        duration: 2000,\n        type: 'success'\n      });\n\n      notification.show();\n    })\n\n  }\n  destroy() {\n    this.subElements = {};\n    for (const component of Object.values(this.components)) {\n      component.destroy();\n    }\n  }\n}\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}